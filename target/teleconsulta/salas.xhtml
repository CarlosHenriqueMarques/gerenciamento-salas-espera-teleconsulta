<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Salas</title>
</h:head>
<h:body>
    <p:toolbar style="margin-bottom:1rem">
        <p:toolbarGroup>
            <p:linkButton value="Início"
                          icon="pi pi-home"
                          outcome="/index.xhtml" />
        </p:toolbarGroup>

        <p:toolbarGroup align="right">
            <h:form id="frmTop">
                <h:outputText value="Olá, #{authMB.contaLogada.login}" rendered="#{authMB.logado}" />
                <p:spacer width="8" rendered="#{authMB.logado}"/>
                <p:commandButton value="Sair" icon="pi pi-sign-out"
                                 action="#{authMB.logout}"
                                 ajax="false" rendered="#{authMB.logado}" />
            </h:form>
        </p:toolbarGroup>
    </p:toolbar>

    <h:form id="frm">
        <p:growl id="growl" showDetail="false" />
        <p:panel header="Gerenciamento de Salas" style="margin-bottom:1rem">
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="Novo" icon="pi pi-plus"
                                     process="@this"
                                     actionListener="#{salaController.novo}"
                                     update=":frm:dlgSala"
                                     oncomplete="PF('dlgSala').show()" />
                </p:toolbarGroup>
                <p:toolbarGroup align="right">
                    <p:inputText id="termo" value="#{salaController.termo}"
                                 placeholder="Nome da sala" style="width:18rem"/>
                    <p:spacer width="6"/>

                    <p:selectOneMenu id="unidadeFiltro" value="#{salaController.unidadeFiltroId}" style="width:18rem">
                        <f:selectItem itemLabel="(todas as unidades)" itemValue="#{null}"/>
                        <f:selectItems value="#{salaController.unidades}" var="u"
                                       itemValue="#{u.id}" itemLabel="#{u.nome}"/>
                    </p:selectOneMenu>

                    <p:spacer width="8"/>

                    <p:commandButton value="Filtrar" icon="pi pi-filter"
                                     process="@this termo unidadeFiltro"
                                     actionListener="#{salaController.filtrar}"
                                     update=":frm:tblSalas :frm:growl"/>
                    <p:spacer width="6"/>
                    <p:commandButton value="Limpar" icon="pi pi-times"
                                     process="@this"
                                     actionListener="#{salaController.limparFiltro}"
                                     update=":frm:tblSalas :frm:growl :frm:termo :frm:unidadeFiltro"
                                     resetValues="true"/>
                </p:toolbarGroup>
            </p:toolbar>
        </p:panel>

        <p:dataTable id="tblSalas" value="#{salaController.salas}" var="s"
                     paginator="true" rows="10" responsiveLayout="scroll"
                     emptyMessage="Nenhuma sala encontrada.">

            <p:column headerText="ID" style="width:80px;text-align:center" sortBy="#{s.id}">
                <h:outputText value="#{s.id}" />
            </p:column>

            <p:column headerText="Nome" sortBy="#{s.nome}">
                <h:outputText value="#{s.nome}" />
            </p:column>

            <p:column headerText="Capacidade" style="width:120px;text-align:center" sortBy="#{s.capacidade}">
                <h:outputText value="#{s.capacidade}" />
            </p:column>

            <p:column headerText="Unidade" sortBy="#{s.unidadeSaude.nome}">
                <h:outputText value="#{s.unidadeSaude.nome}" />
            </p:column>

            <p:column headerText="Cadastro" style="width:220px" sortBy="#{s.dataCadastro}">
                <h:outputText value="#{s.dataCadastro}">
                    <f:convertDateTime type="localDateTime" pattern="dd/MM/yyyy HH:mm"/>
                </h:outputText>
            </p:column>

            <p:column headerText="Ações" style="width:160px;text-align:center">
                <p:commandButton icon="pi pi-pencil" title="Editar"
                                 process="@this"
                                 actionListener="#{salaController.editar(s)}"
                                 update=":frm:dlgSala"
                                 oncomplete="PF('dlgSala').show()"/>
                <p:spacer width="6"/>
                <p:commandButton icon="pi pi-trash" title="Excluir"
                                 process="@this"
                                 actionListener="#{salaController.excluir(s)}"
                                 update=":frm:tblSalas :frm:growl"/>
            </p:column>
        </p:dataTable>

        <p:dialog id="dlgSala" header="Sala" widgetVar="dlgSala" modal="true"
                  closable="true" resizable="false" width="600">

            <p:panelGrid columns="2" columnClasses="col1,col2"
                         layout="grid" styleClass="ui-fluid" style="width:100%">

                <p:outputLabel for="nome" value="Nome"/>
                <p:inputText id="nome" value="#{salaController.atual.nome}" required="true" maxlength="120"/>

                <p:outputLabel for="capacidade" value="Capacidade"/>
                <p:inputNumber id="capacidade" value="#{salaController.atual.capacidade}"
                               decimalPlaces="0" minValue="1"  maxValue="99" required="true" />

                <p:outputLabel for="unidadeSel" value="Unidade de Saúde"/>
                <p:selectOneMenu id="unidadeSel" value="#{salaController.unidadeSelId}" required="true" style="width:100%">
                    <f:selectItem itemLabel="(selecione)" itemValue="#{null}"/>
                    <f:selectItems value="#{salaController.unidades}" var="u"
                                   itemValue="#{u.id}" itemLabel="#{u.nome}"/>
                </p:selectOneMenu>
            </p:panelGrid>

            <p:separator/>

            <p:commandButton value="Salvar" icon="pi pi-check"
                             process="@this, nome, capacidade, unidadeSel"
                             actionListener="#{salaController.salvar}"
                             update=":frm:tblSalas :frm:growl"
                             oncomplete="if (!args.validationFailed) PF('dlgSala').hide();"/>
            <p:spacer width="8"/>
            <p:commandButton value="Cancelar" icon="pi pi-times" type="button"
                             onclick="PF('dlgSala').hide()"/>
        </p:dialog>
    </h:form>
</h:body>
</html>
