<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Unidades de Saúde</title>
</h:head>
<h:body>

    <!-- Link para Início -->
    <p:toolbar style="margin-bottom:1rem">
        <p:toolbarGroup>
            <p:linkButton value="Início" icon="pi pi-home" outcome="/index.xhtml" />
        </p:toolbarGroup>
    </p:toolbar>

    <h:form id="frm">
        <p:growl id="growl" showDetail="false" />

        <p:panel header="Gerenciamento de Unidades de Saúde" style="margin-bottom:1rem">
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="Novo"
                                     icon="pi pi-plus"
                                     process="@this"
                                     actionListener="#{unidadeMB.novo}"
                                     update=":frm:dlgUnidade"
                                     oncomplete="PF('dlgUnidade').show()" />
                </p:toolbarGroup>

                <p:toolbarGroup align="right">
                    <!-- dê um ID para poder processar -->
                    <p:inputText id="termo"
                                 value="#{unidadeMB.filtro}"
                                 placeholder="Nome / Razão social / Sigla"
                                 style="width:22rem" />

                    <p:spacer width="6"/>

                    <p:commandButton value="Filtrar" icon="pi pi-filter"
                                     process="@this termo"
                                     actionListener="#{unidadeMB.filtrar}"
                                     update=":frm:tblUnidades :frm:growl" />

                    <p:spacer width="6"/>

                    <p:commandButton value="Limpar" icon="pi pi-times"
                                     process="@this"
                                     actionListener="#{unidadeMB.limparFiltro}"
                                     update=":frm:tblUnidades :frm:growl :frm:termo"
                                     resetValues="true"/>
                </p:toolbarGroup>
            </p:toolbar>
        </p:panel>

        <p:dataTable id="tblUnidades" value="#{unidadeMB.unidades}" var="u"
                     paginator="true" rows="10" responsiveLayout="scroll"
                     emptyMessage="Nenhuma unidade encontrada.">

            <p:column headerText="ID" sortBy="#{u.id}" style="width:80px;text-align:center">
                <h:outputText value="#{u.id}" />
            </p:column>

            <p:column headerText="Nome" sortBy="#{u.nome}">
                <h:outputText value="#{u.nome}" />
            </p:column>

            <p:column headerText="Razão Social" sortBy="#{u.razaoSocial}">
                <h:outputText value="#{u.razaoSocial}" />
            </p:column>

            <p:column headerText="Sigla" sortBy="#{u.sigla}" style="width:120px;text-align:center">
                <h:outputText value="#{u.sigla}" />
            </p:column>

            <p:column headerText="CNPJ" sortBy="#{u.cnpj}" style="width:160px">
                <h:outputText value="#{u.cnpj}" />
            </p:column>

            <p:column headerText="CNES" sortBy="#{u.cnes}" style="width:120px">
                <h:outputText value="#{u.cnes}" />
            </p:column>

            <p:column headerText="Cadastro" sortBy="#{u.dataCadastro}" style="width:220px">
                <h:outputText value="#{u.dataCadastro}">
                    <f:convertDateTime type="localDateTime" pattern="dd/MM/yyyy HH:mm" />
                </h:outputText>
            </p:column>

            <p:column headerText="Ações" style="width:160px;text-align:center">
                <p:commandButton icon="pi pi-pencil" title="Editar"
                                 process="@this"
                                 actionListener="#{unidadeMB.editar(u)}"
                                 update=":frm:dlgUnidade"
                                 oncomplete="PF('dlgUnidade').show()" />
                <p:spacer width="6"/>
                <p:commandButton icon="pi pi-trash" title="Excluir"
                                 process="@this"
                                 actionListener="#{unidadeMB.excluir(u)}"
                                 update=":frm:tblUnidades :frm:growl" />
            </p:column>
        </p:dataTable>

        <!-- Diálogo de cadastro/edição -->
        <p:dialog id="dlgUnidade" header="Unidade de Saúde"
                  widgetVar="dlgUnidade" modal="true" closable="true"
                  resizable="false" width="620">

            <p:panelGrid columns="2" columnClasses="col1,col2"
                         layout="grid" styleClass="ui-fluid" style="width:100%">

                <p:outputLabel for="nome" value="Nome *"/>
                <p:inputText id="nome" value="#{unidadeMB.atual.nome}" required="true" maxlength="120" />

                <p:outputLabel for="razao" value="Razão Social *"/>
                <p:inputText id="razao" value="#{unidadeMB.atual.razaoSocial}" required="true" maxlength="150" />

                <p:outputLabel for="sigla" value="Sigla *"/>
                <p:inputText id="sigla" value="#{unidadeMB.atual.sigla}" required="true" maxlength="20" />

                <p:outputLabel for="cnpj" value="CNPJ * (14 dígitos)"/>
                <p:inputText id="cnpj" value="#{unidadeMB.atual.cnpj}" required="true" maxlength="14" />

                <p:outputLabel for="cnes" value="CNES * (7 dígitos)"/>
                <p:inputText id="cnes" value="#{unidadeMB.atual.cnes}" required="true" maxlength="7" />
            </p:panelGrid>

            <p:separator/>

            <p:commandButton value="Salvar" icon="pi pi-check"
                             process="@this, nome, razao, sigla, cnpj, cnes"
                             actionListener="#{unidadeMB.salvar}"
                             update=":frm:tblUnidades :frm:growl"
                             oncomplete="if (!args.validationFailed) PF('dlgUnidade').hide();" />
            <p:spacer width="8"/>
            <p:commandButton value="Cancelar" icon="pi pi-times" type="button"
                             onclick="PF('dlgUnidade').hide()"/>
        </p:dialog>
    </h:form>
</h:body>
</html>
