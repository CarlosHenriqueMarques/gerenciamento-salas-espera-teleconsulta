<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Pacientes</title>
</h:head>
<h:body>
    <p:toolbar style="margin-bottom:1rem">
        <p:toolbarGroup>
            <p:linkButton value="Início"
                          icon="pi pi-home"
                          outcome="/index.xhtml" />
        </p:toolbarGroup>
    </p:toolbar>

    <h:form id="frm">
        <p:growl id="growl" showDetail="false" />

        <p:panel header="Gerenciamento de Pacientes" style="margin-bottom:1rem">
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="Novo"
                                     icon="pi pi-plus"
                                     process="@this"
                                     actionListener="#{pacienteMB.novo}"
                                     update=":frm:dlgPaciente"
                                     oncomplete="PF('dlgPaciente').show()"/>
                </p:toolbarGroup>
                <p:toolbarGroup align="right">

                    <p:inputText id="termo"
                                 value="#{pacienteMB.termo}"
                                 placeholder="Buscar: nome, doc, e-mail, tel"
                                 style="width:22rem"/>

                    <p:spacer width="6"/>

                    <p:datePicker id="nascIni"
                                  value="#{pacienteMB.nascIni}"
                                  pattern="dd/MM/yyyy"
                                  showIcon="true"
                                  placeholder="Nascimento: de"/>

                    <p:spacer width="6"/>

                    <p:datePicker id="nascFim"
                                  value="#{pacienteMB.nascFim}"
                                  pattern="dd/MM/yyyy"
                                  showIcon="true"
                                  placeholder="até"/>

                    <p:spacer width="8"/>

                    <p:commandButton value="Filtrar" icon="pi pi-filter"
                                     process="@this termo nascIni nascFim"
                                     actionListener="#{pacienteMB.filtrar}"
                                     update=":frm:tblPacientes :frm:growl"/>

                    <p:spacer width="6"/>

                    <p:commandButton value="Limpar" icon="pi pi-times"
                                     process="@this"
                                     actionListener="#{pacienteMB.limparFiltro}"
                                     update=":frm:tblPacientes :frm:growl :frm:termo :frm:nascIni :frm:nascFim"
                                     resetValues="true"/>

                </p:toolbarGroup>

            </p:toolbar>
        </p:panel>

        <p:dataTable id="tblPacientes" value="#{pacienteMB.pacientes}" var="p"
                     paginator="true" rows="10" responsiveLayout="scroll"
                     emptyMessage="Nenhum paciente encontrado.">

            <p:column headerText="ID" style="width:80px;text-align:center" sortBy="#{p.id}">
                <h:outputText value="#{p.id}"/>
            </p:column>

            <p:column headerText="Nome" sortBy="#{p.nome}">
                <h:outputText value="#{p.nome}"/>
            </p:column>

            <p:column headerText="Sexo" style="width:120px" sortBy="#{p.sexo}">
                <h:outputText value="#{p.sexo}"/>
            </p:column>

            <p:column headerText="Nascimento" style="width:160px" sortBy="#{p.dataNascimento}">
                <h:outputText value="#{p.dataNascimento}">
                    <f:convertDateTime type="localDate" pattern="dd/MM/yyyy"/>
                </h:outputText>
            </p:column>

            <p:column headerText="Telefone" style="width:150px">
                <h:outputText value="#{p.telefone}"/>
            </p:column>

            <p:column headerText="E-mail" sortBy="#{p.email}">
                <h:outputText value="#{p.email}"/>
            </p:column>

            <p:column headerText="CPF" style="width:140px" sortBy="#{p.cpf}">
                <h:outputText value="#{p.cpf}"/>
            </p:column>

            <p:column headerText="CNS" style="width:180px" sortBy="#{p.cns}">
                <h:outputText value="#{p.cns}"/>
            </p:column>

            <p:column headerText="Ações" style="width:160px;text-align:center">
                <p:commandButton icon="pi pi-pencil" title="Editar"
                                 process="@this"
                                 actionListener="#{pacienteMB.editar(p)}"
                                 update=":frm:dlgPaciente"
                                 oncomplete="PF('dlgPaciente').show()"/>
                <p:spacer width="6"/>
                <p:commandButton icon="pi pi-trash" title="Excluir"
                                 process="@this"
                                 actionListener="#{pacienteMB.excluir(p)}"
                                 update=":frm:tblPacientes :frm:growl"/>
            </p:column>
        </p:dataTable>

        <p:dialog id="dlgPaciente" header="Paciente" widgetVar="dlgPaciente"
                  modal="true" closable="true" resizable="false" width="720">

            <p:panelGrid columns="2" columnClasses="col1,col2" layout="grid" styleClass="ui-fluid" style="width:90%">
                <p:outputLabel for="nome" value="Nome"/>
                <p:inputText id="nome" value="#{pacienteMB.atual.nome}" required="true" maxlength="120"/>

                <p:outputLabel for="nomeSocial" value="Nome social"/>
                <p:inputText id="nomeSocial" value="#{pacienteMB.atual.nomeSocial}" maxlength="120"/>

                <p:outputLabel for="sexo" value="Sexo"/>
                <p:selectOneMenu id="sexo" value="#{pacienteMB.atual.sexo}" style="width:100%">
                    <f:selectItem itemLabel="(selecione)" itemValue="#{null}"/>
                    <f:selectItems value="#{pacienteMB.sexos}" var="s" itemValue="#{s}" itemLabel="#{s}"/>
                </p:selectOneMenu>

                <p:outputLabel for="nasc" value="Nascimento"/>
                <p:datePicker id="nasc" value="#{pacienteMB.atual.dataNascimento}" pattern="dd/MM/yyyy" showIcon="true"/>

                <p:outputLabel for="nomeMae" value="Nome da mãe"/>
                <p:inputText id="nomeMae" value="#{pacienteMB.atual.nomeMae}" maxlength="120"/>

                <p:outputLabel for="nomePai" value="Nome do pai"/>
                <p:inputText id="nomePai" value="#{pacienteMB.atual.nomePai}" maxlength="120"/>

                <p:outputLabel for="telefone" value="Telefone"/>
                <p:inputText id="telefone" value="#{pacienteMB.atual.telefone}" maxlength="20"/>

                <p:outputLabel for="email" value="E-mail"/>
                <p:inputText id="email" value="#{pacienteMB.atual.email}" maxlength="150"/>

                <p:outputLabel for="cpf" value="CPF (11 dígitos)"/>
                <p:inputText id="cpf" value="#{pacienteMB.atual.cpf}" maxlength="11"/>

                <p:outputLabel for="rg" value="RG"/>
                <p:inputText id="rg" value="#{pacienteMB.atual.rg}" maxlength="20"/>

                <p:outputLabel for="cns" value="CNS (15 dígitos)"/>
                <p:inputText id="cns" value="#{pacienteMB.atual.cns}" maxlength="15"/>

                <p:outputLabel for="endereco" value="Endereço"/>
                <p:inputTextarea id="endereco" value="#{pacienteMB.atual.endereco}" maxlength="255" autoResize="true" rows="2"/>
            </p:panelGrid>

            <p:separator/>

            <p:commandButton value="Salvar" icon="pi pi-check"
                             process="@this, nome, nomeSocial, sexo, nasc, nomeMae, nomePai, telefone, email, cpf, rg, cns, endereco"
                             actionListener="#{pacienteMB.salvar}"
                             update=":frm:tblPacientes :frm:growl"
                             oncomplete="if (!args.validationFailed) PF('dlgPaciente').hide();" />
            <p:spacer width="8"/>
            <p:commandButton value="Cancelar" icon="pi pi-times" type="button"
                             onclick="PF('dlgPaciente').hide()"/>
        </p:dialog>
    </h:form>
</h:body>
</html>
